<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GiftMint Web App</title>
    <link rel="stylesheet" href="./CSS5/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- –ë–ê–ù–ù–ï–†–´ (–í–´–õ–ï–ó–ê–Æ–¢ –°–í–ï–†–•–£) -->
        <div id="reg-success-banner" class="top-banner success">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! ‚úÖ</div>
        <div id="condition-banner" class="top-banner warning">–í—ã–ø–æ–ª–Ω–∏—Ç–µ —É—Å–ª–æ–≤–∏—è: –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å 5-10 –¥—Ä—É–∑—å—è–º–∏! üéÅ</div>

        <header class="header">
            <h1 class="title">GiftMint</h1>
            <div class="conditions-box">
                <p class="conditions-label">üéÅ –•–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å NFT-–ø–æ–¥–∞—Ä–æ–∫?<br>–ù–∞—à –ø—Ä–æ–µ–∫—Ç "Gifty" —Ç–µ–±–µ –ø–æ–º–æ–∂–µ—Ç ‚Äî –≤—ã–ø–æ–ª–Ω–∏ –ø—Ä–æ—Å—Ç—ã–µ —É—Å–ª–æ–≤–∏—è –∏ —É–≤–µ–ª–∏—á—å —Å–≤–æ–π —à–∞–Ω—Å:</p>
                <p class="conditions-text">
                    1) –ù–∞–∂–º–∏ –Ω–∞ —Ç—Ä–∏ —Ç–æ—á–∫–∏ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É Gifty<br> 
                    2) –í—ã–±–µ—Ä–∏ ¬´–ü–æ–¥–µ–ª–∏—Ç—å—Å—è¬ª –∏ –æ—Ç–ø—Ä–∞–≤—å –¥—Ä—É–∑—å—è–º<br> 
                    3) –ß–µ–º —á–∞—â–µ –¥–µ–ª–∏—à—å—Å—è ‚Äî —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å –Ω–∞ —Ä–µ–¥–∫–∏–π –ø–æ–¥–∞—Ä–æ–∫ üíé
                </p>
            </div>
        </header>

        <!-- –†–£–õ–ï–¢–ö–ê ‚Ññ1 -->
        <div class="roulette-section">
            <div class="roulette-wrapper">
                <div class="roulette-track" id="track1">
                    <div class="nft-card">üèÜ <span>‚≠ê 100</span></div>
                    <div class="nft-card">üíç <span>‚≠ê 100</span></div>
                    <div class="nft-card">üíé <span>‚≠ê 100</span></div>
                    <div class="nft-card">üçæ <span>‚≠ê 50</span></div>
                    <div class="nft-card">üíê <span>‚≠ê 50</span></div>
                    <div class="nft-card">üèÜ <span>‚≠ê 100</span></div>
                    <div class="nft-card">üíç <span>‚≠ê 100</span></div>
                    <div class="nft-card">üíé <span>‚≠ê 100</span></div>
                    <div class="nft-card">üçæ <span>‚≠ê 50</span></div>
                    <div class="nft-card">üíê <span>‚≠ê 50</span></div>
                </div>
            </div>
            <button class="spin-btn action-spin" data-goal="5">–ö—Ä—É—Ç–∏—Ç—å <span class="share-count">0</span>/5</button>
        </div>

        <!-- –†–£–õ–ï–¢–ö–ê ‚Ññ2 -->
        <div class="roulette-section">
            <div class="roulette-wrapper">
                <div class="roulette-track" id="track2">
                    <div class="nft-card pink"><img src="./images/img1.png" class="nft-image"><span>‚≠ê 623</span></div>
                    <div class="nft-card pink"><img src="./images/img2.png" class="nft-image"><span>‚≠ê 1022</span></div>
                    <div class="nft-card pink"><img src="./images/img3.png" class="nft-image"><span>‚≠ê 4460</span></div>
                    <div class="nft-card pink"><img src="./images/img4.png" class="nft-image"><span>‚≠ê 1213</span></div>
                    <div class="nft-card pink"><img src="./images/img5.png" class="nft-image"><span>‚≠ê 849</span></div>
                    <!-- –ü–æ–≤—Ç–æ—Ä –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ -->
                    <div class="nft-card pink"><img src="./images/img1.png" class="nft-image"><span>‚≠ê 623</span></div>
                    <div class="nft-card pink"><img src="./images/img2.png" class="nft-image"><span>‚≠ê 1022</span></div>
                    <div class="nft-card pink"><img src="./images/img3.png" class="nft-image"><span>‚≠ê 4460</span></div>
                    <div class="nft-card pink"><img src="./images/img4.png" class="nft-image"><span>‚≠ê 1213</span></div>
                    <div class="nft-card pink"><img src="./images/img5.png" class="nft-image"><span>‚≠ê 849</span></div>
                </div>
            </div>
            <button class="spin-btn action-spin" data-goal="10">–ö—Ä—É—Ç–∏—Ç—å <span class="share-count">0</span>/10</button>
        </div>

        <!-- –°–ï–ö–¶–ò–Ø –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò -->
        <footer class="footer" id="registration-section">
            <label for="username">–í–≤–µ–¥–∏ username –∞–∫–∫–∞—É–Ω—Ç–∞ –∫—É–¥–∞ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫</label>
            <div class="input-with-btn">
                <input type="text" id="username" placeholder="@username...">
                <button id="next-to-wallet" class="next-btn">‚ûî</button>
            </div>
            <span id="username-error" class="error-text">–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —é–∑–µ—Ä–Ω–µ–π–º</span>
        </footer>

        <!-- –°–ï–ö–¶–ò–Ø –ö–û–®–ï–õ–¨–ö–ê -->
        <div id="wallet-section" class="wallet-box">
            <p style="margin-bottom: 15px; font-weight: bold;">–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫:</p>
            <div id="ton-connect-btn"></div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê: –¢–†–ï–ë–£–ï–¢–°–Ø –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø -->
    <div id="modal-reg-required" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-title">–í–Ω–∏–º–∞–Ω–∏–µ!</h2>
            <p class="modal-subtitle">–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã.</p>
            <button id="go-to-reg" class="modal-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
    </div>

    <script>
        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TonConnect
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://balbesss213.github.io/my-tg-app/tonconnect-manifest.json', 
            buttonRootId: 'ton-connect-btn' 
        });

        window.Telegram.WebApp.ready();

        // 2. "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" (localStorage)
        const db = {
            get isReg() { return localStorage.getItem('isReg') === 'true' },
            set isReg(v) { localStorage.setItem('isReg', v) },
            get count() { return parseInt(localStorage.getItem('count') || '0') },
            set count(v) { localStorage.setItem('count', v) }
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const usernameInput = document.getElementById('username');
        const usernameError = document.getElementById('username-error');
        const modalReg = document.getElementById('modal-reg-required');
        const walletSection = document.getElementById('wallet-section');

        // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–æ–∫ "–ö—Ä—É—Ç–∏—Ç—å"
        document.querySelectorAll('.action-spin').forEach(btn => {
            btn.onclick = () => {
                if (!db.isReg) {
                    modalReg.style.display = 'flex';
                } else {
                    // –ï—Å–ª–∏ —Ä–µ–≥–∞ –µ—Å—Ç—å ‚Äî –ø—Ä–æ—Å–∏–º —É—Å–ª–æ–≤–∏—è
                    showBanner('condition-banner');
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —à–∞—Ä–∏–Ω–≥ –¢–ì
                    Telegram.WebApp.openTelegramLink(`https://t.me/share/url?url=https://t.me/NFTreat_Bot/myapp&text=–ü–æ–ª—É—á–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π NFT –ø–æ–¥–∞—Ä–æ–∫!`);
                    db.count += 1;
                    updateUI();
                }
            };
        });

        // –ö–Ω–æ–ø–∫–∞ –∏–∑ –º–æ–¥–∞–ª–∫–∏ –≤–Ω–∏–∑
        document.getElementById('go-to-reg').onclick = () => {
            modalReg.style.display = 'none';
            document.getElementById('registration-section').scrollIntoView({ behavior: 'smooth' });
        };

        // –ö–Ω–æ–ø–∫–∞ Next (—Å—Ç—Ä–µ–ª–æ—á–∫–∞)
        document.getElementById('next-to-wallet').onclick = () => {
            let val = usernameInput.value;
            if (val.length > 3 && !/[–∞-—è—ë]/i.test(val)) {
                walletSection.style.scrollIntoView({ behavior: 'smooth' });
                walletSection.style.border = '2px solid var(--button-color)';
            } else {
                usernameError.style.display = 'block';
            }
        };

        // Username –ª–æ–≥–∏–∫–∞
        usernameInput.addEventListener('input', () => {
            if (!usernameInput.value.startsWith('@')) usernameInput.value = '@' + usernameInput.value.replace('@','');
            usernameError.style.display = /[–∞-—è—ë]/i.test(usernameInput.value) ? 'block' : 'none';
        });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ -> –§–ò–ù–ê–õ –†–ï–ì–ò
        tonConnectUI.onStatusChange(wallet => {
            if (wallet && !db.isReg) {
                db.isReg = true;
                showBanner('reg-success-banner');
                setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 2000);
            }
            updateUI();
        });

        function showBanner(id) {
            const b = document.getElementById(id);
            b.classList.add('show');
            setTimeout(() => b.classList.remove('show'), 4000);
        }

        function updateUI() {
            document.querySelectorAll('.share-count').forEach(el => el.innerText = db.count);
        }

        updateUI();
    </script>
</body>
</html>